<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Prof.: Pedro Albarrán" />
<meta name="author" content="Prof.: Alberto Pérez" />


<title>Ejercicio Tema 06B - Bucles</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Big Data (UA)</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Introducción</a>
</li>
<li>
  <a href="Contenidos.html">Contenidos</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Ejercicio Tema 06B - Bucles</h1>
<h4 class="author">Prof.: Pedro Albarrán</h4>
<h4 class="author">Prof.: Alberto Pérez</h4>
<h4 class="date">Universidad de Alicante, Curso 2020/21</h4>

</div>


<div id="aplicar-una-función-a-un-vector-de-valores" class="section level2">
<h2>Aplicar una función a un vector de valores</h2>
<p>Definimos una función para encontrar el año más popular para un nombre específico.</p>
<pre class="r"><code>library(babynames)
anno_mas_popular &lt;- function(name_arg) {
  babynames %&gt;%
    filter(name == name_arg) %&gt;%
    group_by(year) %&gt;%
    summarize(total = sum(prop)) %&gt;%
    arrange(desc(total)) %&gt;%
    head(1) %&gt;%
    select(year)
}</code></pre>
<p>Si sólo quisiéramos realizar la tarea una vez, no habría necesidad de escribir la función, ya que podríamos simplemente escribir la tubería (que constituye el cuerpo de la función). Si sólo quisiéramos realizar la tarea unas cuantas veces, entonces probablemente estaría bien llamar a la función unas cuantas veces:</p>
<pre class="r"><code>anno_mas_popular(name_arg = &quot;Larry&quot;)
anno_mas_popular(name_arg = &quot;Moe&quot;)
anno_mas_popular(name_arg = &quot;Curly&quot;)</code></pre>
</div>
<div id="map" class="section level2">
<h2><code>map()</code></h2>
<p>¿Pero y si tuviéramos una larga lista de nombres? No nos gustaría tener que copiar y pegar ese código repetidamente. La solución es crear un vector que contenga los nombres que nos interesan, y luego usar la función <code>map()</code> para aplicar la función a cada elemento del vector. Para leer más sobre esta función, podemos buscar en la ayuda de RStudio o escribir <code>?map</code> en la consola.</p>
<blockquote>
<p>Nota: en algunos otros lenguajes de programación una operación: mapear o <code>map()</code>.</p>
</blockquote>
<p>Por ejemplo, las personas en una familia tienen los siguientes nombres:</p>
<pre class="r"><code>bens_people &lt;- c(&quot;Benjamin&quot;, &quot;Cory&quot;, &quot;Alice&quot;, &quot;Arlo&quot;, 
                 &quot;Andrew&quot;, &quot;Anna&quot;, &quot;Hanna&quot;, &quot;Josephine&quot;)</code></pre>
<p>Para poder llamar a la función <code>anno_mas_popular()</code> en cada uno de esos nombres, podemos escribir:</p>
<pre class="r"><code>map(bens_people, anno_mas_popular)</code></pre>
<p>La función <code>map()</code> siempre devuelve una lista. Necesitamos utilizar una de las funciones <code>map_*()</code> que especifica el tipo de datos que devuelve. En este caso, como <code>anno_mas_popular()</code> devuelve un <code>data.frame</code>, utilizamos <code>map_dfr()</code>:</p>
<pre class="r"><code>map_dfr(bens_people, anno_mas_popular) </code></pre>
<div id="for-frente-a-map" class="section level3">
<h3><code>for</code> frente a <code>map()</code></h3>
<p>Lógicamente, usar <code>map()</code> es muy parecido a usar un bucle <code>for</code>. Estos son perfectamente aceptables en R, pero no forman parte del estilo de codificación R (orientado a tratamiento de datos en lugar de programación “pura”). Además, hay situaciones en las que los bucles son menos claros que <code>map()</code>. Si nos encuentramos con un problema en R y creemos querer usar un bucle, debemos preguntarnos si realmente necesitamos conocer los valores del índice. Si no es el caso (lo cual es casi siempre), entonces se puede hacer sin usar un bucle <code>for</code>. En su lugar, escribamos una función para realizar la tarea una vez, y luego repetimos la función con <code>map()</code>.</p>
</div>
</div>
<div id="aplicación-de-una-función-a-un-conjunto-de-datos-agrupado" class="section level2">
<h2>Aplicación de una función a un conjunto de datos agrupado</h2>
<p>Supongamos que queremos calcular los 10 nombres más populares. Esta función lo hará:</p>
<pre class="r"><code>top10 &lt;- function(data) {
  data %&gt;%
    group_by(name) %&gt;%
    summarize(births = sum(n)) %&gt;%
    arrange(desc(births)) %&gt;%
    head(10)
}
top10(data = babynames)</code></pre>
<p>Pero ahora supongamos que queremos aplicar esta función a cada década. Podríamos intentar dividir la tabla de nombres de bebé en una lista de <em>dataframes</em> - uno por cada década - y luego usar <code>map()</code> para iterar sobre esa lista. En su lugar, primero podemos usar <code>group_by()</code> para establecer una variable de agrupación. Podrías estar tentado a usar <code>map()</code> para iterar la función <code>top10()</code> sobre este resultado; NO funcionará porque <code>group_by()</code> devuelve un <code>tibble</code> agrupado, que no es una lista (o vector). En su lugar, usamos la función <code>group_modify()</code>, que funciona como <code>map()</code>, pero en un <code>tibble</code> agrupado en lugar de una lista (o vector). Obsérvese que el marco de datos resultante tiene una variable llamada década que indica el primer año de la década correspondiente.</p>
<pre class="r"><code>top_by_decade &lt;- babynames %&gt;%
  mutate(decade = 10 * floor(year / 10)) %&gt;%
  group_by(decade) %&gt;%
  group_modify(~top10(.x))</code></pre>
<p>El <code>.</code> aquí es un marcador de posición que indica el <em>dataframe</em> correspondiente a cada década. En la ayuda de <code>%&gt;%</code> vemos:</p>
<blockquote>
<p>Se puede utilizar el punto (.) como marcador de posición. Por ejemplo, <code>y %&gt;% f(x,.)</code> es equivalente a <code>f(x,y)</code> y <code>z %&gt;% f(x, y, arg =.)</code> es equivalente a <code>f(x, y, arg =.)</code> es equivalente a <code>f(x, y, arg = z)</code>.</p>
</blockquote>
<p>Puesto que <code>top10()</code> devuelve un <em>tibble</em>, el objeto <code>top_by_decade</code> es también un <em>tibble</em> que tiene 10 filas por cada década, todas apiladas una encima de la otra.</p>
</div>
<div id="vuestro-ejercicio" class="section level2">
<h2>Vuestro ejercicio</h2>
<ol style="list-style-type: decimal">
<li><p>Usar <code>map()</code> y la función que escribiste en el apartado 1 del “Ejercicio Tema 06A - Funciones” para encontrar los cinco destinos aeroportuarios más comunes para Delta, American y United Airlines.</p></li>
<li><p>Usar <code>map()</code> y la función que escribiste en el apartado 3 del “Ejercicio Tema 06A - Funciones” para encontrar las cinco aerolíneas más comunes a los aeropuertos internacionales de Bradley, Los Ángeles y San Francisco.</p></li>
<li><p>¿Cuántas filas tiene <code>top_by_decade</code>? Explica brevemente cómo se llegó allí.</p></li>
<li><p>Mostrar el contenido de la 11º fila de <code>top_by_decade</code> y explicar que implica para el nombre mostrado allí.</p></li>
<li><p>Aplica la función <code>top10()</code> a cada conjunto de 20 años consecutivos.</p></li>
</ol>
<ul>
<li>Rellenad este <a href="https://docs.google.com/forms/d/e/1FAIpQLScvr_xR608YVM1aoFX6LQgvG1SjuRSPbs3UfzJDiARuIOxVzg/viewform">FORMULARIO</a> con vuestros datos, respondiendo a las preguntas que requieren contestación escrita y subid vuestro archivo de R para responder a el resto de preguntas.</li>
</ul>
<p>IMPORTANTE: el nombre de los ficheros que subáis DEBE EMPEZAR con vuestro número de DNI. Por ejemplo,</p>
<ul>
<li>12345678_ET06B_micodigo.R</li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
