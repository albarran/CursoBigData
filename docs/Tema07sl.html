<!DOCTYPE html>
<html>
<head>
  <title>Tema 07 - Fundamentos Estadísticos</title>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="generator" content="pandoc" />




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <base target="_blank">

  <script type="text/javascript">
    var SLIDE_CONFIG = {
      // Slide settings
      settings: {
                title: 'Tema 07 - Fundamentos Estadísticos',
                        useBuilds: true,
        usePrettify: true,
        enableSlideAreas: true,
        enableTouch: true,
                        favIcon: 'Tema07sl_files/logo.svg',
              },

      // Author information
      presenters: [
            {
        name:  'Prof.: Pedro Albarrán' ,
        company: '',
        gplus: '',
        twitter: '',
        www: '',
        github: ''
      },
            {
        name:  'Prof.: Alberto Pérez' ,
        company: '',
        gplus: '',
        twitter: '',
        www: '',
        github: ''
      },
            ]
    };
  </script>

  <link href="site_libs/ioslides-13.5.1/fonts/fonts.css" rel="stylesheet" />
  <link href="site_libs/ioslides-13.5.1/theme/css/default.css" rel="stylesheet" />
  <link href="site_libs/ioslides-13.5.1/theme/css/phone.css" rel="stylesheet" />
  <script src="site_libs/ioslides-13.5.1/js/modernizr.custom.45394.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/prettify.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/lang-r.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/lang-yaml.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/hammer.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/slide-controller.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/slide-deck.js"></script>

  <style type="text/css">

    b, strong {
      font-weight: bold;
    }

    em {
      font-style: italic;
    }

    summary {
      display: list-item;
    }

    slides > slide {
      -webkit-transition: all 0.4s ease-in-out;
      -moz-transition: all 0.4s ease-in-out;
      -o-transition: all 0.4s ease-in-out;
      transition: all 0.4s ease-in-out;
    }

    .auto-fadein {
      -webkit-transition: opacity 0.6s ease-in;
      -webkit-transition-delay: 0.4s;
      -moz-transition: opacity 0.6s ease-in 0.4s;
      -o-transition: opacity 0.6s ease-in 0.4s;
      transition: opacity 0.6s ease-in 0.4s;
      opacity: 0;
    }
/* https://github.com/ropensci/plotly/pull/524#issuecomment-468142578 */
slide:not(.current) .plotly.html-widget{
  display: block;
}

    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
            code.sourceCode > span { display: inline-block; line-height: 1.25; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode { white-space: pre; position: relative; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    code.sourceCode { white-space: pre-wrap; }
    code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
        
    slides > slide:not(.nobackground):before {
      font-size: 12pt;
      content: "";
      position: absolute;
      bottom: 20px;
      left: 60px;
      background: url(Tema07sl_files/logo.svg) no-repeat 0 50%;
      -webkit-background-size: 30px 30px;
      -moz-background-size: 30px 30px;
      -o-background-size: 30px 30px;
      background-size: 30px 30px;
      padding-left: 40px;
      height: 30px;
      line-height: 1.9;
    }
  </style>


</head>

<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="title-slide segue nobackground">
        <aside class="gdbar"><img src="Tema07sl_files/logo.svg"></aside>
        <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      
      <p data-config-presenter><!-- populated from slide_config.json --></p>
            <p style="margin-top: 6px; margin-left: -2px;">Universidad de Alicante, Curso 2020/21</p>
          </hgroup>
  </slide>

<slide class=""><hgroup><h2>Fundamentos Estadísticos</h2></hgroup><article  id="fundamentos-estadísticos">

<ul>
<li>Objetivo: extraer información de los datos.</li>
</ul>

<center>

<img src='pic/model.png' title=''/>

</center>

<ul>
<li>Herramientas previas:

<ul>
<li>Limpieza y Transformación</li>
<li>Detectar patrones iniciales</li>
</ul></li>
<li>Métodos estadísticos, incluyendo <strong>modelización</strong>

<ul>
<li>Encontrar patrones complejos, y cuantifificar su fortaleza</li>
<li>Interpretación de datos</li>
</ul></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Muestras y Poblaciones</h2></hgroup><article  id="muestras-y-poblaciones">

<ul>
<li>Los datos (casos observados) son una <em>muestra</em> de una <em>población</em> mayor (de casos potenciales)</li>
</ul>

<center>

<img width="82%" src='pic/sample-pop2.png' title=''/>

</center>

</article></slide><slide class=""><hgroup><h2>Muestreo de la población</h2></hgroup><article  id="muestreo-de-la-población">

<ul>
<li><p>Sabiendo el retraso medio desde NY a San Francisco (SFO) podemos planificar la antelación con que se toma el vuelo</p></li>
<li><p>Suponemos que la muestra total observada en <code>nycflights13</code> ha salido de una población teórica de una distribución lognormal:</p></li>
</ul>

<pre class = 'prettyprint lang-r'>library(nycflights13)
SF &lt;- flights %&gt;%
  filter(dest == &quot;SFO&quot;, !is.na(arr_delay))

SF %&gt;%  
  ggplot() + geom_histogram(aes(x=arr_delay, y=..density..)) +
             geom_line(aes(x = arr_delay, 
                           y = dlnorm(SF$arr_delay+87, 4.403,0.409)
                           ))</pre>

</article></slide><slide class=""><hgroup><h2>Decisiones basadas en datos observados</h2></hgroup><article  id="decisiones-basadas-en-datos-observados">

<ul>
<li>Disponemos de una muestra con información de solo \(n=25\) vuelos</li>
</ul>

<pre class = 'prettyprint lang-r'>set.seed(501) # set.seed(501)  set.seed(1001) 
datos1 &lt;- tibble(x = (rlnorm(n = 25, meanlog = 4.403, sdlog = 0.409) - 87) ) 
x &lt;- datos1 %&gt;% summarize(med=mean(x), sd = sd(x))
x</pre>

<!--
- `set.seed()` para especificar cómo imitar la selección aleatoria mediante *generador pseudo-aleatorio*.
-->

<ul>
<li>Regla: bajo normalidad, sólo el 2,27% se retrasan más que \(\mu + 2\sigma\):</li>
</ul>

<pre class = 'prettyprint lang-r'>plnorm( (x$med + 2 * x$sd) , meanlog = 4.403, sdlog = 0.409, lower.tail = FALSE)</pre>

<ol>
<li><p>¿Era el supuesto apropiado?</p></li>
<li><p>Condicionar a día, hora, aerolínea</p></li>
<li><p>¿Qué sabemos sobre la incertidumbre en la estimación de \(\mu\) y \(\sigma\)?</p></li>
</ol>

</article></slide><slide class=""><hgroup><h2>Incertidumbre por la distribución del muestreo</h2></hgroup><article  id="incertidumbre-por-la-distribución-del-muestreo">

<ul>
<li>¿Cómo de fiable es un estadístico muestral? Simulemos la distribución de la media en muchas muestras todas de tamaño \(n=25\)</li>
</ul>

<pre class = 'prettyprint lang-r'>Muestras &lt;- list()
set.seed(101)
for(i in 1:100){
  Muestras[[i]] &lt;- tibble(x = rlnorm(n = 25, meanlog = 4.403, sdlog = 0.409) - 87)  %&gt;% 
        summarize(media = mean(x), sd = sd(x))
}
Muestras_df &lt;- Muestras %&gt;% bind_rows()
Muestras_df</pre>

<ul>
<li><p>Existe una gran variabilidad del estadístico muestral: es poco fiable</p></li>
<li><p>En una situación realista (solo tenemos UNA MUESTRA), ¿es posible <strong>cuantificar la incertidumbre</strong>?</p></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Distribuciones muestrales</h2></hgroup><article  id="distribuciones-muestrales">

<ul>
<li><p>Un <em>estadístico</em> es un valor calculado a partir de una muestra (ej., la media)</p></li>
<li><p><strong>Distribución muestral</strong> es la distribución del estadístico en las muestras potenciales de <strong>tamaño muestral \(n\)</strong></p>

<ul>
<li>si conocemos las distribución poblacional que genera las muestras, podemos disponer de muestras y ver cómo varía el valor del estadístico</li>
</ul></li>
</ul>

<!--    + aquí lo hemos aproximado con 100 muestras -->

<pre class = 'prettyprint lang-r'>Muestras %&gt;% bind_rows() %&gt;% ggplot(aes(x=media)) + geom_density()</pre>

<ul>
<li><p>Por supuesto, nos interesan varios aspectos de la distribución muestral como su <em>forma</em> y <em>error estándar</em> (<!--desviación típica (variabilidad)--> variabilidad de la distribución muestral)</p></li>
<li><p>El <em>intervalo de confianza del 95%</em> es otra forma de resumir la distribución muestral</p></li>
</ul>

<pre class = 'prettyprint lang-r'>mean(Muestras_df$media) + sd(Muestras_df$media) * 1.96 * c(-1,1) </pre>

</article></slide><slide class=""><hgroup><h2>Distribuciones muestrales (cont.)</h2></hgroup><article  id="distribuciones-muestrales-cont.">

<!--
* La fiabilidad de un estadístico muestral se mide  por 

  1. la media del estadístico (media de la distribución muestral): debe estar cerca del verdadero (en la población). 

  2. el error estándar del estadístico (error estándar de la distribución muestral); debe ser pequeño. 
-->

<ul>
<li>¿Cómo cambia la media y el error estándar del estadístico cuando varia el tamaño muestral?</li>
</ul>

<pre class = 'prettyprint lang-r'>Muestras_porN &lt;- list()
nvec &lt;- c(25, 50, 100, 200)
for(j in seq_along(nvec)){
  n &lt;- nvec[j]
  Muestras &lt;- list()   # bucle anterior, generalizando n y conservándolo en summarize
  set.seed(101)
  for(i in 1:100){
    Muestras[[i]] &lt;- tibble(x = rlnorm(n = n, meanlog = 4.403, sdlog = 0.409) - 87)  %&gt;%   
        summarize(media = mean(x), sd = sd(x), n = n)      
  }
  Muestras_porN[[j]] &lt;- Muestras %&gt;% bind_rows()
}
Muestras_Final &lt;- Muestras_porN %&gt;% bind_rows()</pre>

</article></slide><slide class=""><hgroup><h2>Distribuciones muestrales: LGN y TCL</h2></hgroup><article  id="distribuciones-muestrales-lgn-y-tcl">

<pre class = 'prettyprint lang-r'>Muestras_Final %&gt;% ggplot(aes(x=media)) + geom_density() + facet_wrap(~n)</pre>

<pre class = 'prettyprint lang-r'>Muestras_Final %&gt;% group_by(n) %&gt;% 
  summarize(media_de_media = mean(media), error = sd(media))</pre>

<ul>
<li><p><em>Ley de números grandes</em>: para un tamaño de la muestra \(n\) grande, el promedio de la muestra está cerca de la media de la población <!--, y el error estándar es pequeño. --></p></li>
<li><p><em>Teorema de Límite Central</em>: para un tamaño de la muestra \(n\) grande, la distribución muestral de la media es normal.</p></li>
<li><p>\(\mbox{Error estándar}(\bar{X}_n) = \frac{\sigma}{\sqrt{n}},\) donde \(\sigma\) es la desviación estándar de la población.</p>

<ul>
<li>Si <strong>aumentamos el tamaño de la muestra en \(n\), el error estándar disminuirá</strong>.</li>
</ul></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Procedimiento <em>Bootstrap</em></h2></hgroup><article  id="procedimiento-bootstrap">

<!-- * En la práctica, sólo tenemos UNA muestra de tamaño $n$ (no la población) -->

<ul>
<li><strong>Idea</strong>: pensar en la ÚNICA muestra como si fuera la población</li>
</ul>

<ol>
<li><p>Tomar muchas nuevas muestras (<em>remuestras</em> o muestras de Bootstrap) con reemplazamiento de la muestra original</p>

<ul>
<li><p>Ej.: para \((1,2,3)\) incluye los casos \((1,1,2)\), \((1,1,3)\), \((2,2,1)\), etc.</p></li>
<li><p>\({n\choose n}= (n + n - 1)!/(n! (n-1)!)\) remuestras: la muestra original es una combinación entre muchas</p></li>
</ul></li>
<li><p>En cada remuestra, se puede calcular cualquier estadístico</p></li>
</ol>

<ul>
<li>Se obtiene la <strong>distribución muestral bootstrap</strong>: NO es la distribución muestral, pero aproxima sus aspectos principales (ej., <em>error estándar</em>).</li>
</ul>

<!--una distribución de valores de los ensayos bootstrap -->

<!-- aproxima para vlaores moderados de n -->

<ul>
<li>Puede aplicarse para cuantificar la incertidumbre de <strong>casi cualquier estadístico</strong> (media, varianzas, coeficientes de regresión, etc.)</li>
</ul>

<!-- es un método estadístico que nos  permite aproximar la distribución muestral sin acceso a la población.-->

</article></slide><slide class=""><hgroup><h2><em>Bootstrap</em> con \(B = 1000\) para <code>datos1</code></h2></hgroup><article  id="bootstrap-con-b-1000-para-datos1">

<pre class = 'prettyprint lang-r'>n &lt;- nrow(datos1)
boot &lt;- list() 
for(i in 1:1000){
    boot[[i]] &lt;- datos1 %&gt;% 
      sample_n(size = n, replace = TRUE) %&gt;%
      summarize(media = mean(x))
  }
boot_df &lt;- boot %&gt;% bind_rows()</pre>

<!-- 
- `sample_n()`  para seleccion filas de forma *aleatoria* de una tabla,
-->

<pre class = 'prettyprint lang-r'>boot_df %&gt;% ggplot(aes(x = media)) + geom_density() # densidad bootstrap de la media</pre>

<pre class = 'prettyprint lang-r'>sd(boot_df$media)                                   # estimación bootstrap del error estándar</pre>

<!--
* Aunque podemos obtener un mejor intervalo de confianza basado


```r
mean(boot_df$media) + c(-1,1) * 1.96 * sd(boot_df$media)
```
-->

<ul>
<li>Sin suponer normalidad o TCL, se obtienen los percentiles del intervalo en la distribución muestral bootstrap:</li>
</ul>

<pre class = 'prettyprint lang-r'>c(sort(boot_df$media)[25], sort(boot_df$media)[975])</pre>

<!--
#### Errores estándar Bootstrap para muestras grandes

El siguiente código toma muestras para la población `SF` sólo una vez para cada uno de los tamaños muestrales 25--200, y utiliza la muestra (sin referencia a la población) para estimar el error estándar. 


```r
Trials.bootstrap <-list()
nvec = c(25,50,100,200)
for(j in seq_along(nvec)){
  n <- nvec[j]
  sample_df <- SF %>% sample_n(size = n)
  Trials_n <- list() 
  for(i in 1:1000){
    Trials_n[[i]] <- sample_df %>% 
      sample_n(size = n, replace = TRUE) %>%
      summarize(mean = mean(arr_delay), n = n)
  }
  Trials.bootstrap[[j]] <- bind_rows(Trials_n)
}
bind_rows(Trials.bootstrap) %>% 
  group_by(n) %>% 
  summarize(error = sd(mean))
```

Estas estimaciones del error estándar, calculadas mediante bootstrapping de la muestra, se aproximan bastante el error estándar, calculado a partir de la población. 

En este ejemplo, el estadístico muestral es la media. En la práctica, los estadísticos de interés son más complejos, por ejemplo, la estimación del coeficiente en el modelo de regresión lineal. El procedimiento de bootsrapping se puede aplicar a casi todas las situaciones, para cuantificar la incertidumbre en un estadístico.
-->

</article></slide><slide class=""><hgroup><h2>Modelización Condicional</h2></hgroup><article  id="modelización-condicional">

<ul>
<li><p>La población NO suele ser <em>homogenea</em>.</p></li>
<li><p>Los retrasos son más frecuentes a determinadas horas</p></li>
</ul>

<pre class = 'prettyprint lang-r'>SF %&gt;%
  ggplot(aes(x = hour, y = arr_delay)) +
  geom_boxplot(aes(group = hour)) + geom_smooth(method = &quot;lm&quot;)  +
  coord_cartesian(ylim = c(-30, 120))</pre>

<pre class = 'prettyprint lang-r'>mod1 &lt;- lm(arr_delay ~ hour, data = SF)
broom::tidy(mod1)</pre>

<ul>
<li>En particular, los grandes retrasos (superior a 60 minutos)</li>
</ul>

<pre class = 'prettyprint lang-r'>SF %&gt;% mutate(gran_retraso = arr_delay &gt; 60) %&gt;%
  ggplot(aes(x = hour, fill= gran_retraso)) + 
  geom_bar(position = &quot;fill&quot;)                  # para representar frecuencia</pre>

</article></slide><slide class=""><hgroup><h2>Modelización Condicional (cont.)</h2></hgroup><article  id="modelización-condicional-cont.">

<!--
* También tenemos variación por mes, día de la semana, aeropuerto de origen, aerolínea, etc.
-->

<ul>
<li>Un modelo de regresión permite incluir todas las <strong>variables explicativas</strong> de la variación de la variable dependiente</li>
</ul>

<pre class = 'prettyprint lang-r'>library(lubridate)
SF2 &lt;- SF %&gt;% 
  mutate(
    fecha  = as.Date(time_hour), 
    diasem = as.factor(wday(day, label = TRUE)),
    estaci = ifelse(month %in% 6:7, &quot;verano&quot;, &quot;otros meses&quot;)
  )

mod2 &lt;- lm(arr_delay ~ hour + origin + carrier + as.factor(month) + dow, data = SF2)
broom::tidy(mod2)</pre>

<ul>
<li>Para una variable de respuesta binaría como <code>gran_retraso</code> puede utilizar la <em>regresión logística</em> (logit)</li>
</ul>

</article></slide><slide class=""><hgroup><h2>&ldquo;Confounding factor&rdquo; y Causalidad</h2></hgroup><article  id="confounding-factor-y-causalidad">

<ul>
<li><p><strong>&ldquo;Correlación no implica causalidad&rdquo;</strong>, salvo en <a href='https://es.wikipedia.org/wiki/Prueba_controlada_aleatorizada' title=''>ensayos científicos aleatorios</a> cuidadosamente controlados</p>

<ul>
<li>en otros campos como marketing digital o analítica de web se denominan <a href='https://es.wikipedia.org/wiki/Prueba_A/B' title=''>pruebas A/B</a> (ej. dos versiones de una misma web)</li>
</ul></li>
<li><p>En general (datos observacionales), nos preocupa que otros factores que puedan ser los verdaderos determinantes de la relación observada</p></li>
<li><p>En los ensayos aleatorios se controla quien recibe una intervención (tratamiento) y quien no (control)</p>

<ul>
<li><p>En promedio, todos los demás factores están equilibrados entre los dos grupos: las diferencias pueden atribuirse a la aplicación del tratamiento</p></li>
<li><p>Pero si los sujetos no cumplen con los tratamientos o se pierden en el seguimiento…</p></li>
</ul></li>
</ul>

</article></slide><slide class=""><hgroup><h2>&ldquo;National Supported Work Demonstration&rdquo;</h2></hgroup><article  id="national-supported-work-demonstration">

<pre class = 'prettyprint lang-r'>url &lt;- &quot;http://www.nber.org/~rdehejia/data/&quot;
nsw &lt;- haven::read_dta(paste0(url,&quot;nsw_dw.dta&quot;)) 
lm(data=nsw %&gt;%  filter(black==1), re78 ~ treat ) %&gt;% broom::tidy()</pre>

<ul>
<li>Añadimos más datos observacionales</li>
</ul>

<pre class = 'prettyprint lang-r'>nsw2 &lt;- nsw %&gt;% bind_rows(haven::read_dta(paste0(url,&quot;psid_controls.dta&quot;))) 
lm(data=nsw2 %&gt;%  filter(black==1), re78 ~ treat ) %&gt;% broom::tidy()</pre>

<ul>
<li>El programa estaba dirigido a quienes previamente ganaban menos:</li>
</ul>

<pre class = 'prettyprint lang-r'>nsw2 &lt;- nsw2 %&gt;% mutate(rePre = (re74+re75)/2)
lm(data=nsw2 %&gt;%  filter(black==1), rePre ~ treat ) %&gt;% broom::tidy()</pre>

<ul>
<li>¿Y si mantenemos &ldquo;constante&rdquo; ese factor en <code>nsw2</code>? ¿Y en <code>nsw</code>? <a href='https://docs.google.com/forms/d/e/1FAIpQLSfTdODmH2MIUuC00wJF9H89aLsQf4KQqDeZ71BgaaSferbn1Q/viewform' title=''>Responder</a></li>
</ul>

<pre class = 'prettyprint lang-r'>lm(data=nsw2 %&gt;%  filter(black==1), re78 ~ treat + rePre) %&gt;% broom::tidy()</pre>

<!--

* PREGUNTA: ¿cambia algo si controlamos por la renta previa usando los datos experimentales?


```r
nsw <- nsw %>% mutate(rePre = (re74+re75)/2)
lm(data=nsw2 %>%  filter(black==1), re78 ~ treat + rePre) %>% broom::tidy()
```


-->

</article></slide><slide class=""><hgroup><h2>Descuentos y ventas</h2></hgroup><article  id="descuentos-y-ventas">

<pre class = 'prettyprint lang-r'>datos &lt;- read_csv(&quot;https://www.dropbox.com/s/c91j0nvg51hwq89/discount.csv?dl=1&quot;)</pre>

<ul>
<li>El porcentaje medio de descuentos afecta negativamente a las ventas</li>
</ul>

<pre class = 'prettyprint lang-r'>datos %&gt;% ggplot(aes(x=discount, y=sales)) + geom_point() + geom_smooth(method = &quot;lm&quot;)</pre>

<pre class = 'prettyprint lang-r'>lm(data = datos, sales ~ discount) %&gt;% broom::tidy()</pre>

<ul>
<li>Pero si tenemos en cuenta la renta…</li>
</ul>

<pre class = 'prettyprint lang-r'>datos %&gt;% mutate(renta_baja = income &lt; 7500) %&gt;%  
  ggplot(aes(x=discount, y=sales)) + geom_point() + geom_smooth(method = &quot;lm&quot;) +
  facet_wrap(~renta_baja)</pre>

<pre class = 'prettyprint lang-r'>lm(data = datos, sales ~ discount + income) %&gt;% broom::tidy()</pre></article></slide>


  <slide class="backdrop"></slide>

</slides>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!-- map slide visiblity events into shiny -->
<script>
  (function() {
    if (window.jQuery) {
       window.jQuery(document).on('slideleave', function(e) {
         window.jQuery(e.target).trigger('hidden');
      });
       window.jQuery(document).on('slideenter', function(e) {
         window.jQuery(e.target).trigger('shown');
      });
    }
  })();
</script>

</body>
</html>
