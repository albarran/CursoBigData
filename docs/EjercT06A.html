<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Prof.: Pedro Albarrán" />
<meta name="author" content="Prof.: Alberto Pérez" />


<title>Ejercicio Tema 06A - Funciones</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Big Data (UA)</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Introducción</a>
</li>
<li>
  <a href="Contenidos.html">Contenidos</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Ejercicio Tema 06A - Funciones</h1>
<h4 class="author">Prof.: Pedro Albarrán</h4>
<h4 class="author">Prof.: Alberto Pérez</h4>
<h4 class="date">Universidad de Alicante, Curso 2020/21</h4>

</div>


<div id="introducción" class="section level2">
<h2>Introducción</h2>
<p>Ya sabemos cómo filtrar un nombre en particular:</p>
<pre class="r"><code>library(tidyverse)
library(babynames)
babynames %&gt;%
  filter(name == &quot;Benjamin&quot;)</code></pre>
<p>Supongamos que queremos encontrar el año en el que ese nombre fue más popular. Para hacer esto necesitamos una tubería de varios verbos encadenados.</p>
<pre class="r"><code>babynames %&gt;%
  filter(name == &quot;Benjamin&quot;) %&gt;%
  group_by(year) %&gt;%
  summarize(total = sum(prop)) %&gt;%
  arrange(desc(total)) %&gt;%
  head(1) %&gt;%
  select(year)</code></pre>
<p>Pero podríamos querer hacer esto para muchos nombres, y sería tedioso tener que volver a escribir - o incluso volver a ejecutar - el mismo código una y otra vez. Una solución elegante es escribir una función. Las funciones son objetos (de primera clase) de R y se crean con el comando <code>function</code>.</p>
<p>Aquí escribimos una función llamada <code>anno_mas_popular()</code> que devolverá el año en el que un nombre específico fue más popular.</p>
<pre class="r"><code>anno_mas_popular &lt;- function(name_arg) {
  babynames %&gt;%
    filter(name == name_arg) %&gt;%
    group_by(year) %&gt;%
    summarize(total = sum(prop)) %&gt;%
    arrange(desc(total)) %&gt;%
    head(1) %&gt;%
    select(year)
}</code></pre>
<p>Ahora podemos ejecutar nuestra función con varios nombres diferentes sin tener que volver a escribir todo ese código.</p>
<pre class="r"><code>anno_mas_popular(name_arg = &quot;Emma&quot;)
anno_mas_popular(name_arg = &quot;Viola&quot;)
anno_mas_popular(name_arg = &quot;Casey&quot;)
anno_mas_popular(name_arg = &quot;Mahershala&quot;)</code></pre>
</div>
<div id="tipos-de-los-argumentos-y-el-resultado" class="section level2">
<h2>Tipos de los argumentos y el resultado</h2>
<p>Mostramos los argumentos que toma una función dada usando la función `formals()’.</p>
<pre class="r"><code>formals(anno_mas_popular)</code></pre>
<p>En este caso, la función <code>anno_mas_popular()</code> toma un solo argumento llamado <code>name_arg</code>, que debería ser un vector de caracteres, y devuelve un <code>tbl_df</code>.</p>
<p>De la forma en que hemos definido <code>anno_mas_popular()</code>, no hay un valor por defecto para <code>name_arg</code>. Así, si llamamos a la función sin argumentos, dará un error y se parará la ejecución.</p>
<pre class="r"><code>anno_mas_popular()</code></pre>
<p>En este caso, este es probablemente el comportamiento deseado, ya que no tiene sentido llamar a esta función sin especificar un nombre. Sin embargo, podríamos haberla definido con un valor por defecto, digamos “Benjamin”. Al llamar a la función sin especificar el argumento, ahora obtendremos los resultados de “Benjamin”.</p>
<pre class="r"><code>anno_mas_popular_ben &lt;- function(name_arg= &quot;Benjamin&quot;) {
  babynames %&gt;%
    filter(name == name_arg) %&gt;%
    group_by(year) %&gt;%
    summarize(total = sum(prop)) %&gt;%
    arrange(desc(total)) %&gt;%
    head(1) %&gt;%
    select(year)
}

anno_mas_popular_ben()</code></pre>
<p>Por supuesto, todavía podemos anular el valor por defecto de <code>name_arg</code>:</p>
<pre class="r"><code>anno_mas_popular_ben(name_arg = &quot;Jordan&quot;)
anno_mas_popular_ben( &quot;Jordan&quot;)</code></pre>
</div>
<div id="ámbito-de-las-variables" class="section level2">
<h2>Ámbito de las variables</h2>
<p>¿Cómo supo nuestra función donde encontrar <code>babynames</code>? R buscará un “dataframe” llamado <code>babynames</code> en el entorno global. Si eliminamos el paquete <code>babynames</code>, quitando así la tabla de <code>babynames</code> del entorno, nuestra función ya no funciona.</p>
<pre class="r"><code>detach(&quot;package:babynames&quot;, unload = TRUE)
anno_mas_popular(&quot;Benjamin&quot;)

library(babynames)  #lo seguimos necesitando</code></pre>
<p>Para ser más explícitos, podríamos pasar la tabla de datos en que queremos buscar a la función. Reescribimos la función para que tome un argumento de datos:</p>
<pre class="r"><code>anno_mas_popular2 &lt;- function(data, name_arg) {
  data %&gt;%
    filter(name == name_arg) %&gt;%
    group_by(year) %&gt;%
    summarize(total = sum(prop)) %&gt;%
    arrange(desc(total)) %&gt;%
    head(1) %&gt;%
    select(year)
}
# error: un argumento, sin valor por defecto, no esta asignado.
anno_mas_popular2(name_arg = &quot;Casey&quot;)

anno_mas_popular2(data = babynames, name_arg = &quot;Casey&quot;)</code></pre>
<p>Esto también nos permite aplicar nuestra función a subconjuntos de los datos originales. Así que podemos buscar el año más popular para Casey entre niños y niñas por separado.</p>
<pre class="r"><code>babynames %&gt;%
  filter(sex == &quot;F&quot;) %&gt;%
  anno_mas_popular2(name_arg = &quot;Casey&quot;)
babynames %&gt;%
  filter(sex == &quot;M&quot;) %&gt;%
  anno_mas_popular2(name_arg = &quot;Casey&quot;)</code></pre>
</div>
<div id="orden-de-los-argumentos" class="section level2">
<h2>Orden de los argumentos</h2>
<p>Recordad que el orden de los argumentos sólo importa si no se nombran.</p>
<pre class="r"><code>anno_mas_popular2(babynames, &quot;Emma&quot;)
anno_mas_popular2(&quot;Emma&quot;, babynames)
anno_mas_popular2(&quot;Emma&quot;, data = babynames)</code></pre>
<p>Para estar seguro (y ser claro y explícito), todos los argumentos deberían nombrarse. A menos que haya una buena razón para no hacerlo.</p>
</div>
<div id="vuestro-ejercicio" class="section level2">
<h2>Vuestro ejercicio</h2>
<p>Estos ejercicios utilizan el paquete de datos <code>nycflights13</code>.</p>
<ol style="list-style-type: decimal">
<li><p>Escribir una función que, para un determinado identificador de aerolínea (por ejemplo, DL), recupere los cinco destinos aeroportuarios más comunes de la ciudad de Nueva York en 2013, y la frecuencia con que la aerolínea voló allí.</p></li>
<li><p>Utilizar la función anterior para encontrar los cinco principales destinos de Delta Airlines (DL) y los de American Airlines (AA). ¿Cuántos de estos destinos son compartidos con Delta?</p></li>
<li><p>Escribir una función que, para un código de aeropuerto determinado (por ejemplo, SFO), recupere las cinco compañías aéreas más comunes que prestan servicio en ese aeropuerto desde la ciudad de Nueva York en 2013, y cuál fue su tiempo medio de retraso en la llegada.</p></li>
</ol>
<ul>
<li>Rellenad este <a href="https://docs.google.com/forms/d/e/1FAIpQLSclnTNp6PoMcTLDuB5dPyoykFKQNZsK1h7f8-z3GsVu_SmL1Q/viewform">FORMULARIO</a> con vuestros datos y subid vuestro archivo de R para responder a estas preguntas.</li>
</ul>
<p>IMPORTANTE: el nombre de los ficheros que subáis DEBE EMPEZAR con vuestro número de DNI. Por ejemplo,</p>
<ul>
<li>12345678_ET06A_micodigo.R</li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
